<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Sample of websocket with golang</title>
        <script src="jquery.min.js"></script>
        <script src="jsonrpc.js"></script>
        <script>
            $(function() {
                var c = jsonrpc.NewClient("ws://"+window.location.host+"/rpc");
                var echo = new WebSocket("ws://"+window.location.host+"/echo");
                //var rpc  = new WebSocket("ws://"+window.location.host+"/rpc");
                //var rpcclient  = new WebSocket("ws://"+window.location.host+"/rpcclient");
                var notify = new WebSocket("ws://"+window.location.host+"/notify");

                var $ul = $('#msg-list');
                var method = '{"method": "Arith.Multiply", "params": [{"A":7, "B":8}], "id": 1}';
                $('#echo').val(method);
                $('#rpc').val("Arith.Divide");

                echo.onmessage = function(e) {
                    console.log("echo-receive:" + e.data);
                    $('<li>').text(e.data).appendTo($ul);
                };
                rpc.onmessage = function(e) {
                    console.log("rpc-receive:" + e.data);
                    $('<li>').text(e.data).appendTo($ul);
                };
                rpcclient.onmessage = function(e) {
                    console.log("rpcclient-receive:" + e.data);
                    $('<li>').text(e.data).appendTo($ul);
                };
                notify.onmessage = function(e) {
                    console.log("notify-receive:" + e.data);
                    $('<li>').text(e.data).appendTo($ul);
                };


                $('#echoBtn').click(function(){
                    var data = $('#echo').val();
                    echo.send(data);
                    console.log("echo-send:" + data);
                });
                $('#rpcBtn').click(function(){
                    var method = $('#rpc').val();
                    c.Call({
                        method: method,
                        args: { A: 7, B: 8 },
                        success: function(result){
                            data = "rpc result: Quo = " + result.Quo + ", Rem = " + result.Rem;
                            $('<li>').text(data).appendTo($ul);
                        },
                        error: function(error){
                            data = "rpc error: " + error;
                            $('<li>').text(data).appendTo($ul);
                        }
                    });
                });
                $('#rpcclientBtn').click(function(){
                    var data = $('#rpcclient').val();
                    rpcclient.send(data);
                    console.log("rpcclient-send:" + data);
                });
                $('#notifyBtn').click(function(){
                    var data = $('#notify').val();
                    notify.send(data);
                    console.log("notify-send:" + data);
                });

                rpc.onerror = function (error) {
                    console.log('RPC Error ' + error);
                };
            });
        </script>
    </head>
    <body>
        <input id="echo" type="text" />
        <input type="button" id="echoBtn" value="echo"></input>
        <input id="rpc" type="text" value="" />
        <input type="button" id="rpcBtn" value="rpc"></input>
        <input id="rpcclient" type="text" value="" />
        <input type="button" id="rpcclientBtn" value="rpcclient"></input>
        <input id="notify" type="text" value="" />
        <input type="button" id="notifyBtn" value="notify"></input>
        <ul id="msg-list"></ul>
    </body>
</html>
